{"version":3,"sources":["server/controllers/util.controller.js"],"names":["maxDistance","load","req","res","next","id","get","then","order","catch","e","json","assign","pilotId","franchise","team","getUnAssignedPilotsByTeam","where","near","center","from_location","pilots","length","validPilots","filter","pilot","_id","toString","isActive","save","unAssign","orderId","savedOrder","uploadImgAsync","img","Promise","resolve","reject","v2","uploader","upload","err","assignPending","getUnAssigned","console","info","orders","forEach","findOne","in","populate","status","updatedOrder","msg","Object","headings","en","data","contents","title","from_address","filters","emit","to_phone","user","firstName","mobileNumber","error","calculateDistanceBetweenLatLongs","coordinates","latLongs","map","latitude","coordinate","longitude","log","getPathLength","calculateDistancePickedToDelivery","timeline","orderPilotMovement","i","indexOf","lonLats","split","pilot_movement","hash","hasOwnProperty","d","slice","calculateFinalCost","distance","timeInSeconds","minDistance","baseFare","finalCost","perKM","perHour","tax","calculateDuration","fromTime","toTime","diff","alertPending","find","ne","sort","createdAt","sendPendingOrderAlert","diffInMinutes","tz","utcOffset","orderCreatedDate","subtract","format","currentDate","template_id","clearReports"],"mappings":"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","file":"util.controller.js","sourceRoot":"../../../../.."}